@using Domain_Layer.DTOs.Basket
@model CustomerBasketDto

@{
    ViewData["Title"] = "Your Studio Basket";
    // حساب الإجمالي الكلي للسلة
    decimal subTotal = Model?.items?.Sum(i => i.Price * i.Quantity) ?? 0;
    decimal shipping = 0;
    decimal total = subTotal + shipping;
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        :root {
            --primary-pink: #d68a8a;
            --primary-hover: #c27676;
            --dark-bg: #0f0f0f;
            --card-bg: #1a1a1a;
            --input-bg: #252525;
            --text-light: #ffffff;
            --text-muted: #a0a0a0;
        }

        body {
            background-color: var(--dark-bg);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-text-size-adjust: 100%;
            -webkit-overflow-scrolling: touch;
        }

        .basket-header {
            padding: 80px 0 50px;
            text-align: center;
            background: linear-gradient(to bottom, #1a1a1a 0%, #0f0f0f 100%);
            margin-bottom: 40px;
            border-bottom: 1px solid #222;
        }

        .basket-title {
            font-family: 'Playfair Display', serif;
            font-size: 3.5rem;
            font-weight: 800;
            text-transform: uppercase;
            background: linear-gradient(45deg, #fff 30%, var(--primary-pink) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .basket-subtitle {
            color: var(--primary-pink);
            font-style: italic;
            font-size: 1.2rem;
            margin-top: 10px;
        }

        /* جدول المنتجات */
        .cart-table {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid #252525;
        }

            .cart-table thead {
                background-color: #1a1a1a;
                border-bottom: 2px solid #252525;
            }

            .cart-table th {
                padding: 20px 15px;
                text-transform: uppercase;
                font-size: 0.85rem;
                letter-spacing: 1px;
                color: var(--text-muted);
                font-weight: 600;
                border-bottom: 1px solid #252525;
            }

            .cart-table td {
                padding: 15px;
                vertical-align: middle;
                border-bottom: 1px solid #252525;
            }

            .cart-table tbody tr:last-child td {
                border-bottom: none;
            }

            .cart-table tbody tr:hover {
                background-color: rgba(214, 138, 138, 0.05);
            }

        .product-img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            background: #202020;
            border: 1px solid #252525;
        }

        .product-name {
            color: var(--text-light);
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-id {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .price-cell {
            color: var(--text-light);
            font-weight: 600;
        }

        .quantity-badge {
            background: var(--input-bg);
            color: var(--text-light);
            border: 1px solid #333;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: 600;
            min-width: 60px;
            display: inline-block;
            text-align: center;
        }

        .total-cell {
            color: var(--primary-pink);
            font-weight: 700;
            font-size: 1.1rem;
        }

        /* ملخص الطلب */
        .order-summary {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid #252525;
            position: sticky;
            top: 20px;
        }

        .order-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-light);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #252525;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #252525;
        }

        .summary-label {
            color: var(--text-muted);
        }

        .summary-value {
            color: var(--text-light);
            font-weight: 600;
        }

        .summary-total {
            font-size: 1.3rem;
            color: var(--primary-pink);
            font-weight: 700;
        }

        .btn-checkout {
            background: var(--primary-pink);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 16px;
            font-weight: 700;
            width: 100%;
            transition: all 0.2s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 20px;
            font-size: 1rem;
        }

            .btn-checkout:hover {
                background: var(--primary-hover);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(214, 138, 138, 0.2);
            }

        .btn-continue {
            background: transparent;
            color: var(--primary-pink);
            border: 1px solid var(--primary-pink);
            border-radius: 10px;
            padding: 12px 25px;
            font-weight: 600;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

            .btn-continue:hover {
                background: var(--primary-pink);
                color: white;
                transform: translateY(-2px);
            }

        .remove-btn {
            background: transparent;
            border: 1px solid #dc3545;
            color: #dc3545;
            border-radius: 6px;
            padding: 8px 12px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

            .remove-btn:hover {
                background: #dc3545;
                color: white;
                transform: scale(1.05);
            }

        /* حالة السلة الفارغة */
        .empty-state {
            padding: 100px 0;
            text-align: center;
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid #252525;
            margin: 50px 0;
        }

            .empty-state i {
                font-size: 5rem;
                color: var(--text-muted);
                margin-bottom: 20px;
                display: block;
            }

            .empty-state h2 {
                color: var(--text-light);
                margin-bottom: 15px;
                font-weight: 700;
            }

            .empty-state p {
                color: var(--text-muted);
                margin-bottom: 30px;
                max-width: 400px;
                margin-left: auto;
                margin-right: auto;
            }

        /* Toast Messages */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        /* Responsive Media Queries */
        @@media (max-width: 768px) {
            .basket-header {
                padding: 50px 0 30px;
            }

            .basket-title {
                font-size: 2.2rem;
            }

            .cart-table {
                font-size: 0.9rem;
            }

                .cart-table th,
                .cart-table td {
                    padding: 10px;
                }

            .product-img {
                width: 60px;
                height: 60px;
            }

            .order-summary {
                position: static;
                margin-top: 30px;
            }
        }

        @@media (max-width: 576px) {
            .basket-title {
                font-size: 1.8rem;
            }

            .cart-table thead {
                display: none;
            }

            .cart-table tbody tr {
                display: block;
                margin-bottom: 20px;
                background: var(--card-bg);
                border-radius: 10px;
                padding: 15px;
                border: 1px solid #252525;
            }

            .cart-table tbody td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px 0;
                border-bottom: 1px solid #252525;
            }

                .cart-table tbody td:last-child {
                    border-bottom: none;
                }

                .cart-table tbody td::before {
                    content: attr(data-label);
                    color: var(--text-muted);
                    font-weight: 600;
                    margin-right: 15px;
                }

            .product-cell {
                flex-direction: column;
                align-items: flex-start !important;
            }

                .product-cell::before {
                    display: none;
                }
        }
    </style>
}

<!-- Toast Messages -->
<div class="toast-container">
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="toast show align-items-center text-white bg-success border-0">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="bi bi-check-circle me-2"></i>
                    @TempData["SuccessMessage"]
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="toast show align-items-center text-white bg-danger border-0">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="bi bi-exclamation-circle me-2"></i>
                    @TempData["ErrorMessage"]
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    }
</div>

<div class="basket-header">
    <div class="container">
        <h1 class="basket-title">Your Beauty Basket</h1>
        <p class="basket-subtitle">Review your professional makeup selection</p>
    </div>
</div>

<div class="container mb-5">
    @if (Model != null && Model.items != null && Model.items.Any())
    {
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="table-responsive cart-table">
                    <table class="table align-middle mb-0">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.items)
                            {
                                <tr>
                                    <td data-label="Product">
                                        <div class="d-flex align-items-center">
                                            <img src="@(string.IsNullOrEmpty(item.PictureUrl) ? "/Files/Images/default.png" : item.PictureUrl)"
                                                 class="product-img me-3" alt="@item.ProductName">
                                            <div>
                                                <div class="product-name">@item.ProductName</div>
                                                <div class="product-id">ID: #@item.productid</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td data-label="Price" class="price-cell">$@item.Price.ToString("F2")</td>
                                    <td data-label="Quantity">
                                        <span class="quantity-badge">@item.Quantity</span>
                                    </td>
                                    <td data-label="Total" class="total-cell">$@((item.Price * item.Quantity).ToString("F2"))</td>
                                    <td data-label="Actions">
                                        <form asp-controller="Basket" asp-action="RemoveFromBasket" method="post">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="productId" value="@item.productid" />
                                            <button type="submit" class="remove-btn" title="Remove from basket">
                                                <i class="bi bi-trash"></i> Remove
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="mt-4">
                    <a href="@Url.Action("GetAllProducts", "Products")" class="btn btn-continue">
                        <i class="bi bi-arrow-left"></i> Continue Shopping
                    </a>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="order-summary">
                    <h4 class="order-title">Order Summary</h4>

                    <div class="summary-row">
                        <span class="summary-label">Subtotal</span>
                        <span class="summary-value">$@subTotal.ToString("F2")</span>
                    </div>

                    <div class="summary-row">
                        <span class="summary-label">Shipping</span>
                        <span class="text-success fw-bold">Free</span>
                    </div>

                    <div class="summary-row">
                        <span class="summary-label">Tax</span>
                        <span class="summary-value">$0.00</span>
                    </div>

                    <div class="summary-row" style="border-bottom: none; padding-bottom: 0;">
                        <span class="summary-label">Discount</span>
                        <span class="text-success fw-bold">-$0.00</span>
                    </div>

                    <div class="summary-row mt-4 pt-4" style="border-top: 2px solid var(--primary-pink); border-bottom: none;">
                        <span class="summary-label summary-total">Total</span>
                        <span class="summary-value summary-total">$@total.ToString("F2")</span>
                    </div>

                    <div class="mt-4">
                        <a asp-controller="Order" asp-action="CreatOrder" class="btn btn-checkout">
                            <i class="bi bi-bag-check me-2"></i> Proceed to Checkout
                        </a>
                    </div>

                    <div class="mt-4 text-center">
                        <div class="d-flex justify-content-center gap-3 mb-3" style="opacity: 0.7;">
                            <i class="bi bi-credit-card-2-front h4"></i>
                            <i class="bi bi-paypal h4"></i>
                            <i class="bi bi-shield-check h4"></i>
                            <i class="bi bi-lock h4"></i>
                        </div>
                        <small class="text-muted">Secure SSL Checkout • 100% Safe & Protected</small>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="empty-state">
            <i class="bi bi-bag-heart"></i>
            <h2>Your basket is empty</h2>
            <p>Looks like you haven't added any magic to your basket yet.</p>
            <a href="@Url.Action("GetAllProducts", "Products")" class="btn btn-checkout" style="width: auto; padding: 12px 40px;">
                <i class="bi bi-bag-plus me-2"></i> Explore Products
            </a>
        </div>
    }
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-hide toast messages after 3 seconds
            setTimeout(function() {
                const toasts = document.querySelectorAll('.toast');
                toasts.forEach(toast => {
                    const bootstrapToast = new bootstrap.Toast(toast);
                    bootstrapToast.hide();
                });
            }, 3000);

            // Responsive table labels for mobile
            if (window.innerWidth <= 576) {
                const tableHeaders = document.querySelectorAll('.cart-table thead th');
                const tableCells = document.querySelectorAll('.cart-table tbody td');

                tableHeaders.forEach((header, index) => {
                    const label = header.textContent;
                    const cells = document.querySelectorAll(`.cart-table tbody td:nth-child(${index + 1})`);
                    cells.forEach(cell => {
                        cell.setAttribute('data-label', label);
                    });
                });
            }
        });
    </script>
}